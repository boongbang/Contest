<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COSS Dashboard - ìŠ¤ë§ˆíŠ¸ ì•½í†µ ê´€ë¦¬</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Poppins:wght@300;400;500;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* [ìˆ˜ì • ì „] dashboard.txt ê¸°ë°˜ ë””ìì¸ ë³µì› */
        :root {
            --app-bg: #6B8E6B; /* ì˜¤ë¦¬ì§€ë„ ë…¹ìƒ‰ */
            --app-bg-dark: #556b57;
            --sidebar-bg: #f5f6fa;
            --text-light: #F1F5EF;
            --text-dark: #333333;
            --accent-color: #E8F5E9;
            --curve-radius: 35px; /* ì˜¤ë¦¬ì§€ë„ ê³¡ë¥  ë³µì› */
            --success-green: #4CAF50;
            --warning-orange: #FF9800;
            --error-red: #F44336;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: #eef1f4; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; 
        }

        .app-wrapper {
            width: 100%; height: 100vh; 
            background-color: var(--app-bg); /* ë…¹ìƒ‰ ë°°ê²½ ìœ ì§€ */
            position: relative; display: flex; flex-direction: column; overflow: hidden;
        }

        @media (min-width: 481px) {
            .app-wrapper { width: 414px; height: 880px; border-radius: 40px; box-shadow: 0 30px 60px rgba(0,0,0,0.2); }
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ (ì˜¤ë¦¬ì§€ë„ ë³µì›) */
        .header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 40px 30px 20px 30px; z-index: 20; color: var(--text-light); 
        }
        .header-title { font-family: 'Merriweather', serif; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .header-actions { display: flex; gap: 15px; align-items: center; }

        /* [ìš”ì²­ì‚¬í•­ ë³µì›] ìš°ì¸¡ ìƒë‹¨ ì„¼ì„œ ìƒíƒœ í‘œì‹œ */
        .sensor-status {
            display: flex; align-items: center; gap: 8px;
            background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 20px; font-size: 0.85rem;
        }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; animation: pulse 2s infinite; }
        .status-dot.active { background-color: #4CAF50; }
        .status-dot.inactive { background-color: #F44336; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* ì‚¬ìš©ì ë©”ë‰´ */
        .user-menu { position: relative; }
        .user-profile-icon {
            width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .dropdown-menu { display: none; position: absolute; top: 50px; right: 0; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); min-width: 200px; z-index: 100; }
        .dropdown-menu.show { display: block; }
        .dropdown-item { padding: 12px 20px; color: var(--text-dark); display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .dropdown-item:hover { background: var(--accent-color); }

        .content-body { display: flex; flex: 1; height: 100%; overflow: hidden; }

        /* [ìš”ì²­ì‚¬í•­ ë³µì›] ì‚¬ì´ë“œë°” ê³¡ì„  ë° ë…¹ìƒ‰ ë°°ê²½ ìœ ì§€ */
        .sidebar-container { 
            width: 90px; background-color: transparent; /* íˆ¬ëª… ìœ ì§€ -> ë’¤ì˜ app-bg(ë…¹ìƒ‰)ì´ ë³´ì„ */
            display: flex; flex-direction: column; height: 100%; padding: 20px 0; position: relative; 
        }
        
        /* ê³¡ì„  íš¨ê³¼ë¥¼ ìœ„í•œ Active Indicator (ì˜¤ë¦¬ì§€ë„ ì½”ë“œ) */
        .active-indicator { position: absolute; left: 0; width: 100%; height: 90px; background: transparent; z-index: 0; transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
        .active-indicator::before { content: ''; position: absolute; bottom: 100%; right: 0; width: 100%; height: 120vh; background-color: var(--sidebar-bg); border-bottom-right-radius: var(--curve-radius); }
        .active-indicator::after { content: ''; position: absolute; top: 100%; right: 0; width: 100%; height: 120vh; background-color: var(--sidebar-bg); border-top-right-radius: var(--curve-radius); }
        .active-indicator.is-first::before { opacity: 0; }

        .sidebar-item { height: 90px; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; color: #999; z-index: 1; transition: color 0.3s; }
        .sidebar-item.active { color: var(--text-dark); /* í™œì„± ì•„ì´ì½˜ ìƒ‰ìƒ */ }
        
        .icon-box { 
            width: 45px; height: 45px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; 
            background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.8); /* ë¹„í™œì„± ìƒíƒœ */
            transition: all 0.3s; 
        }
        /* í™œì„±í™”ë˜ë©´ ì•„ì´ì½˜ ë°•ìŠ¤ê°€ ì§„í•´ì§ */
        .sidebar-item.active .icon-box { background: var(--text-dark); color: var(--app-bg); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        .sidebar-filler { flex: 1; }

        /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
        .main-content { 
            flex: 1; padding: 0 25px 30px 10px; overflow-y: auto; 
            background-color: var(--sidebar-bg); /* í°ìƒ‰/íšŒìƒ‰ ë°°ê²½ */
            /* [ì¤‘ìš”] ì‚¬ì´ë“œë°”ì™€ ì—°ê²°ë˜ëŠ” ê³¡ì„  ì²˜ë¦¬ë¥¼ ìœ„í•´ í•„ìš” */
            border-top-left-radius: var(--curve-radius); 
        }
        .main-content::-webkit-scrollbar { display: none; }

        .page-section { display: none; animation: fadeInUp 0.5s forwards; }
        .page-section.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .welcome-text { color: var(--text-dark); margin: 30px 0 25px 5px; }
        .welcome-text h2 { font-family: 'Merriweather', serif; font-size: 1.8rem; color: var(--app-bg); }
        .welcome-text p { font-size: 0.9rem; opacity: 0.8; color: #666; }

        /* [ê¸°ëŠ¥ A] ë””ì§€í„¸ ì‹œê³„ ì¹´ë“œ (ë””ìì¸ì€ ì˜¤ë¦¬ì§€ë„ ëŠë‚Œìœ¼ë¡œ í†µí•©) */
        .digital-clock-section {
            background: linear-gradient(135deg, var(--app-bg) 0%, var(--app-bg-dark) 100%);
            border-radius: 25px; padding: 25px; color: white; margin-bottom: 25px;
            box-shadow: 0 10px 20px rgba(107, 142, 107, 0.3); text-align: center; position: relative; overflow: hidden;
        }
        .digital-clock-section::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            animation: rotate 20s linear infinite;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .clock-time { font-family: 'Orbitron', monospace; font-size: 3.2rem; font-weight: 700; position: relative; text-shadow: 0 4px 10px rgba(0,0,0,0.2); margin: 10px 0; }
        .clock-message { position: relative; font-size: 1rem; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; display: inline-block; backdrop-filter: blur(5px); }
        .clock-message.alert { background: rgba(255, 152, 0, 0.9); color: white; animation: pulse 1s infinite; font-weight: bold; }
        .clock-message.warning { background: rgba(244, 67, 54, 0.9); color: white; }
        .clock-message.success { background: rgba(76, 175, 80, 0.9); color: white; }

        /* [ê¸°ëŠ¥ B] 4ë‹¨ê³„ ë³µì•½ íƒ€ì„ë¼ì¸ (ì¹´ë“œí˜•) */
        .timeline-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px; }
        .timeline-card {
            background: white; border-radius: 20px; padding: 20px;
            display: flex; flex-direction: column; justify-content: space-between; height: 140px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid transparent; position: relative;
        }
        .timeline-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        /* ìƒíƒœë³„ ìŠ¤íƒ€ì¼ */
        .timeline-card.completed { border-color: var(--success-green); background: #F1F8E9; }
        .timeline-card.pending { border-color: var(--warning-orange); }
        .timeline-card.missed { border-color: var(--error-red); background: #FFEBEE; }
        
        .timeline-icon { 
            width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; margin-bottom: 10px; 
            background: #f0f0f0; color: #999; transition: all 0.3s;
        }
        .timeline-card.completed .timeline-icon { background: var(--success-green); color: white; }
        .timeline-card.pending .timeline-icon { background: var(--warning-orange); color: white; }
        .timeline-card.missed .timeline-icon { background: var(--error-red); color: white; }

        .timeline-title { font-size: 1rem; font-weight: 700; color: var(--text-dark); }
        .timeline-time { font-size: 0.8rem; color: #666; margin-top: 2px; }
        .timeline-check { position: absolute; top: 15px; right: 15px; font-size: 1.2rem; color: #ddd; }
        .timeline-card.completed .timeline-check { color: var(--success-green); }

        /* [ê¸°ëŠ¥ C] í•˜ë‹¨ í†µê³„ íƒ­ */
        .chart-section { background: white; border-radius: 25px; padding: 25px; margin-bottom: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; background: #f0f0f0; padding: 5px; border-radius: 15px; }
        .tab-btn { flex: 1; padding: 10px; text-align: center; border-radius: 12px; cursor: pointer; font-size: 0.9rem; color: #666; transition: all 0.3s; }
        .tab-btn.active { background: var(--app-bg); color: white; font-weight: 600; shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .insight-box { margin-top: 15px; padding: 15px; background: #E8F5E9; border-radius: 15px; color: var(--app-bg-dark); font-size: 0.9rem; display: flex; align-items: center; gap: 10px; }
        
        /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
        .loading-overlay { display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(107, 142, 107, 0.9); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; color: white; }
        .loading-overlay.show { display: flex; }
        .spinner { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>
    <div class="app-wrapper">
        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
            <p>ë°ì´í„° ë¡œë”© ì¤‘...</p>
        </div>

        <div class="header">
            <div class="header-title">
                <i class="fa-solid fa-pills"></i> COSS
            </div>
            <div class="header-actions">
                <div class="sensor-status">
                    <div class="status-dot" id="sensorStatusDot"></div>
                    <span id="sensorStatusText">ì—°ê²° ëŒ€ê¸°</span>
                </div>
                
                <div class="user-menu">
                    <div class="user-profile-icon" onclick="toggleUserMenu()">
                        <i class="fa-regular fa-user"></i>
                    </div>
                    <div class="dropdown-menu" id="userDropdown">
                        <div class="dropdown-item" onclick="logout()">
                            <i class="fa-solid fa-sign-out-alt"></i> <span>ë¡œê·¸ì•„ì›ƒ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-body">
            <div class="sidebar-container">
                <div class="active-indicator"></div>
                <div class="sidebar-item active" data-section="dashboard" onclick="switchSection('dashboard', 0)">
                    <div class="icon-box"><i class="fa-solid fa-chart-pie"></i></div>
                </div>
                <div class="sidebar-item" data-section="reports" onclick="window.location.href='/reports.html'">
                    <div class="icon-box"><i class="fa-solid fa-file-contract"></i></div>
                </div>
                <div class="sidebar-filler"></div>
            </div>

            <div class="main-content">
                <section id="dashboardSection" class="page-section active">
                    <div class="welcome-text">
                        <h2>Hello, <span id="userName">User</span></h2>
                        <p>ì˜¤ëŠ˜ì˜ ë³µì•½ ìŠ¤ì¼€ì¤„ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                    </div>

                    <div class="digital-clock-section">
                        <div style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 5px;">CURRENT TIME</div>
                        <div class="clock-time" id="digitalClock">00:00</div>
                        <div class="clock-message" id="medicationMessage">ì‹œìŠ¤í…œ ë¶„ì„ ì¤‘...</div>
                    </div>

                    <div style="margin-bottom: 15px; font-weight: 600; color: #333; padding-left: 5px;">ì˜¤ëŠ˜ì˜ ë³µì•½ (4ë‹¨ê³„)</div>
                    <div class="timeline-grid" id="timelineGrid">
                        </div>

                    <div class="chart-section">
                        <div class="tabs">
                            <div class="tab-btn active" onclick="updateChart('weekly')">ì£¼ê°„</div>
                            <div class="tab-btn" onclick="updateChart('daily')">ì¼ê°„</div>
                        </div>
                        <div style="height: 200px;">
                            <canvas id="statsChart"></canvas>
                        </div>
                        <div class="insight-box" id="chartInsight">
                            <i class="fa-solid fa-lightbulb"></i>
                            <span>ë°ì´í„° ë¶„ì„ ì¤‘...</span>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        const API_URL = window.location.origin;
        let authToken = localStorage.getItem('authToken');
        let statsChart = null;

        // ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            if (!authToken) { window.location.href = '/index.html'; return; }
            const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
            document.getElementById('userName').textContent = userInfo.name || 'User';

            // ì‚¬ì´ë“œë°” ì´ˆê¸° ìœ„ì¹˜ ì„¤ì •
            moveIndicator(0);
            
            // ì‹œê³„ ì‹œì‘
            startClock();
            
            // ë°ì´í„° ë¡œë“œ
            loadDashboardData();
            
            // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ (ì„¼ì„œ ìƒíƒœ ë“±)
            setInterval(loadDashboardData, 5000); // 5ì´ˆë§ˆë‹¤
        });

        // [ê¸°ëŠ¥ A] ë””ì§€í„¸ ì‹œê³„ ë¡œì§
        function startClock() {
            function update() {
                const now = new Date();
                document.getElementById('digitalClock').textContent = 
                    `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            }
            update();
            setInterval(update, 1000);
        }

        // ë°ì´í„° ë¡œë“œ ë° UI ì—…ë°ì´íŠ¸
        async function loadDashboardData() {
            try {
                // ìƒë‹¨ ìš°ì¸¡ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸ (ì˜¤ë¦¬ì§€ë„ ê¸°ëŠ¥ ë³µì›)
                updateSensorStatus(true); // ì„ì‹œ: ì„±ê³µìœ¼ë¡œ ê°€ì • (ì‹¤ì œë¡œëŠ” fetch ì„±ê³µ ì—¬ë¶€ ë”°ë¦„)

                const res = await fetch(`${API_URL}/api/dashboard/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if(!res.ok) throw new Error("API Error");
                const data = await res.json();

                // 1. ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                updateMedicationMessage(data.nextMedication, data.sensors);

                // 2. íƒ€ì„ë¼ì¸ ì—…ë°ì´íŠ¸ (ì„¼ì„œ 1~4 ë§¤í•‘)
                updateTimeline(data.sensors);

                // 3. ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ì²˜ìŒ ë¡œë“œ ì‹œ ì£¼ê°„)
                if(!statsChart) updateChart('weekly', data);

            } catch (e) {
                console.error(e);
                updateSensorStatus(false);
            }
        }

        // [ê¸°ëŠ¥ A ìƒì„¸] ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ ë¡œì§
        function updateMedicationMessage(nextMed, sensors) {
            const msgEl = document.getElementById('medicationMessage');
            
            // ê²½ê³  ì²´í¬ (ì•„ì¹¨ ì•½(1ë²ˆ)ì„ ì ì‹¬(13ì‹œ)ê¹Œì§€ ì•ˆ ë¨¹ì—ˆì„ ë•Œ ë“±)
            const now = new Date();
            const currentHour = now.getHours();
            
            // ì˜ˆì‹œ: 12ì‹œê°€ ì§€ë‚¬ëŠ”ë° ì•„ì¹¨ì•½(1ë²ˆ)ì„ ì•ˆ ë¨¹ì—ˆë‹¤ë©´ ê²½ê³ 
            if (currentHour >= 12 && !sensors[1].todayOpened) {
                msgEl.innerHTML = "âš ï¸ <strong>ì•„ì¹¨ ì•½í†µ(1ë²ˆ)</strong>ì´ ì•„ì§ ì—´ë¦¬ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
                msgEl.className = "clock-message warning";
                return;
            }

            // ì•Œë¦¼/í‰ìƒì‹œ/ì™„ë£Œ ë¡œì§
            let allDone = true;
            for(let id in sensors) { if(!sensors[id].todayOpened) allDone = false; }

            if (allDone) {
                msgEl.textContent = "âœ… ì˜¤ëŠ˜ì˜ ëª¨ë“  ì•½ ë³µìš© ì™„ë£Œ!";
                msgEl.className = "clock-message success";
            } else if (nextMed) {
                if (nextMed.timeRemaining <= 30) {
                    // ì•Œë¦¼ (ì£¼ëª©ë„ ë†’ì€ ì£¼í™©ìƒ‰)
                    msgEl.innerHTML = `ğŸ”” <strong>${nextMed.sensor.name}(${nextMed.sensor.id}ë²ˆ)</strong>ì„ ì—´ì–´ ì•½ì„ ë“œì„¸ìš”!`;
                    msgEl.className = "clock-message alert";
                } else {
                    // í‰ìƒì‹œ
                    const h = Math.floor(nextMed.timeRemaining/60);
                    const m = nextMed.timeRemaining%60;
                    msgEl.textContent = `${nextMed.sensor.name} ë³µìš©ê¹Œì§€ ${h}ì‹œê°„ ${m}ë¶„ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`;
                    msgEl.className = "clock-message";
                }
            } else {
                msgEl.textContent = "í˜„ì¬ ì˜ˆì •ëœ ë³µì•½ì´ ì—†ìŠµë‹ˆë‹¤.";
                msgEl.className = "clock-message";
            }
        }

        // [ê¸°ëŠ¥ B ìƒì„¸] 4ë‹¨ê³„ íƒ€ì„ë¼ì¸ ìƒì„±
        function updateTimeline(sensors) {
            const container = document.getElementById('timelineGrid');
            const sensorIds = [1, 2, 3, 4];
            const icons = ['fa-sun', 'fa-cloud-sun', 'fa-moon', 'fa-bed']; // ì•„ì´ì½˜ ë§¤í•‘
            
            let html = '';
            
            sensorIds.forEach((id, idx) => {
                const s = sensors[id];
                // ìƒíƒœ ê²°ì • ë¡œì§
                let statusClass = 'pending';
                if (s.todayOpened) statusClass = 'completed';
                else {
                    // ì‹œê°„ ì§€ë‚¬ëŠ”ì§€ ì²´í¬ (ê°„ë‹¨íˆ ë¬¸ìì—´ ë¹„êµ)
                    const nowStr = new Date().toTimeString().slice(0, 5);
                    if (s.targetTime < nowStr) statusClass = 'missed';
                }

                html += `
                    <div class="timeline-card ${statusClass}">
                        <i class="fa-solid fa-circle-check timeline-check"></i>
                        <div class="timeline-icon">
                            <i class="fa-solid ${icons[idx]}"></i>
                        </div>
                        <div>
                            <div class="timeline-title">${s.name}</div>
                            <div class="timeline-time">${s.targetTime}</div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // [ê¸°ëŠ¥ C ìƒì„¸] ì°¨íŠ¸ ë° ì¸ì‚¬ì´íŠ¸
        async function updateChart(period, preloadedData) {
            // íƒ­ ìŠ¤íƒ€ì¼ í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active');
                if(b.textContent.includes(period === 'weekly' ? 'ì£¼ê°„' : 'ì¼ê°„')) b.classList.add('active');
            });

            // ë°ì´í„° ì¤€ë¹„ (ì‹¤ì œë¡œëŠ” API í˜¸ì¶œ í•„ìš”í•  ìˆ˜ ìˆìŒ)
            let labels, dataPoints, insight;
            
            // ë”ë¯¸ ë°ì´í„°/ë¡œì§ ì˜ˆì‹œ (ì‹¤ì œ API ë°ì´í„°ì™€ ì—°ë™ ê¶Œì¥)
            if(period === 'weekly') {
                labels = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
                dataPoints = [3, 4, 2, 4, 3, 4, 4]; // ì˜ˆì‹œ ë°ì´í„°
                insight = "ìˆ˜ìš”ì¼ì— ë³µì•½ ë‹¬ì„±ë¥ ì´ ê°€ì¥ ë‚®ìŠµë‹ˆë‹¤.";
            } else {
                labels = ['ì•„ì¹¨', 'ì ì‹¬', 'ì €ë…', 'ì·¨ì¹¨'];
                dataPoints = [1, 1, 0, 1]; // ì˜¤ëŠ˜ ë°ì´í„° ì˜ˆì‹œ
                insight = "ì €ë… ì•½í†µ(3ë²ˆ)ì˜ ê°œë´‰ ë¹ˆë„ê°€ ë‚®ìŠµë‹ˆë‹¤.";
            }

            document.getElementById('chartInsight').innerHTML = `<i class="fa-solid fa-lightbulb"></i> <span>${insight}</span>`;

            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            const ctx = document.getElementById('statsChart').getContext('2d');
            if (statsChart) statsChart.destroy();

            statsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ë³µì•½ ì™„ë£Œ',
                        data: dataPoints,
                        backgroundColor: period === 'weekly' ? '#6B8E6B' : ['#FF9800', '#FF9800', '#F44336', '#4CAF50'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 4, grid: { borderDash: [5, 5] } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // ìƒë‹¨ ìš°ì¸¡ ì„¼ì„œ ìƒíƒœ í‘œì‹œ (ì˜¤ë¦¬ì§€ë„ ê¸°ëŠ¥)
        function updateSensorStatus(isOnline) {
            const dot = document.getElementById('sensorStatusDot');
            const text = document.getElementById('sensorStatusText');
            if(isOnline) {
                dot.className = 'status-dot active';
                text.textContent = 'ì‹¤ì‹œê°„';
            } else {
                dot.className = 'status-dot inactive';
                text.textContent = 'ì—°ê²° ëŠê¹€';
            }
        }

        // ì‚¬ì´ë“œë°” ì¸ë””ì¼€ì´í„° ì´ë™ (ê³¡ì„  íš¨ê³¼)
        function switchSection(id, index) {
            moveIndicator(index);
        }
        function moveIndicator(index) {
            const ind = document.querySelector('.active-indicator');
            ind.style.transform = `translateY(${index * 90}px)`; // ì•„ì´í…œ ë†’ì´ 90px
            if (index === 0) ind.classList.add('is-first'); else ind.classList.remove('is-first');
        }

        function toggleUserMenu() {
            document.getElementById('userDropdown').classList.toggle('show');
        }
        function logout() {
            localStorage.removeItem('authToken');
            window.location.href = '/index.html';
        }
    </script>
</body>
</html>
