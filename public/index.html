<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSS - ìŠ¤ë§ˆíŠ¸ ì•½í†µ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- í°íŠ¸ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Clean & Care ìƒ‰ìƒ íŒ”ë ˆíŠ¸ */
            --main-color: #2A9D8F;
            --sub-color: #E9C46A;
            --point-color: #E76F51;
            --bg-color: #F4F7F6;
            --text-color: #264653;
            --white: #FFFFFF;
            --success: #52C41A;
            --warning: #FAAD14;
            --error: #FF4D4F;
            --shadow: rgba(38, 70, 83, 0.08);
            --shadow-hover: rgba(38, 70, 83, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            line-height: 1.6;
            font-size: 16px;
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 0;
            background: var(--white);
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 40px var(--shadow);
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, var(--main-color) 0%, #238B7F 100%);
            color: var(--white);
            padding: 30px 24px;
            border-radius: 0 0 30px 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
            animation: float 15s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .greeting {
            position: relative;
            z-index: 1;
        }

        .greeting h1 {
            font-size: 20px;
            font-weight: 300;
            margin-bottom: 8px;
            opacity: 0.95;
        }

        .greeting .name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .greeting .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ìƒíƒœ íˆì–´ë¡œ ì¹´ë“œ */
        .status-hero {
            margin: -40px 24px 24px;
            background: var(--white);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 10px 30px var(--shadow);
            position: relative;
            z-index: 10;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .status-hero:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px var(--shadow-hover);
        }

        .status-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .status-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            flex-shrink: 0;
        }

        .status-icon.completed {
            background: rgba(82, 196, 26, 0.1);
            color: var(--success);
        }

        .status-icon.pending {
            background: rgba(250, 173, 20, 0.1);
            color: var(--warning);
        }

        .status-icon.detected {
            background: rgba(231, 111, 81, 0.1);
            color: var(--point-color);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .status-text h2 {
            font-size: 18px;
            margin-bottom: 4px;
            color: var(--text-color);
        }

        .status-text p {
            font-size: 14px;
            color: rgba(38, 70, 83, 0.7);
        }

        /* ì‹¤ì‹œê°„ ì„¼ì„œ ìƒíƒœ */
        .sensor-status {
            margin: 0 24px 24px;
            padding: 20px;
            background: linear-gradient(145deg, #f8f9fa, #e8eaec);
            border-radius: 16px;
            border: 1px solid rgba(42, 157, 143, 0.1);
        }

        .sensor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .sensor-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-color);
        }

        .sensor-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .sensor-indicator.active {
            background: rgba(82, 196, 26, 0.1);
            color: var(--success);
        }

        .sensor-indicator.inactive {
            background: rgba(255, 77, 79, 0.1);
            color: var(--error);
        }

        .sensor-indicator::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .sensor-value-display {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 12px;
        }

        .sensor-value-display .value {
            font-size: 42px;
            font-weight: 700;
            color: var(--main-color);
        }

        .sensor-value-display .unit {
            font-size: 16px;
            color: rgba(38, 70, 83, 0.6);
        }

        /* í†µê³„ ê·¸ë¦¬ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(42, 157, 143, 0.1);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--main-color);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .stat-label {
            font-size: 12px;
            color: rgba(38, 70, 83, 0.6);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-color);
        }

        .stat-value.highlight {
            color: var(--main-color);
        }

        /* ì•½ ë³µìš© ì¹´ë“œ */
        .medication-section {
            padding: 0 24px 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .medication-card {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px var(--shadow);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .medication-card:hover {
            transform: translateX(4px);
            box-shadow: 0 6px 20px var(--shadow-hover);
            border-color: var(--main-color);
        }

        .medication-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: linear-gradient(135deg, rgba(42, 157, 143, 0.1) 0%, rgba(42, 157, 143, 0.05) 100%);
            color: var(--main-color);
        }

        .medication-info {
            flex: 1;
        }

        .medication-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-color);
        }

        .medication-time {
            font-size: 13px;
            color: rgba(38, 70, 83, 0.7);
        }

        .medication-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .medication-status.taken {
            background: rgba(82, 196, 26, 0.1);
            color: var(--success);
        }

        .medication-status.pending {
            background: rgba(250, 173, 20, 0.1);
            color: var(--warning);
        }

        .medication-status.missed {
            background: rgba(231, 111, 81, 0.1);
            color: var(--point-color);
        }

        /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
        .control-section {
            padding: 0 24px 100px;
        }

        .control-buttons {
            display: flex;
            gap: 12px;
        }

        .control-btn {
            flex: 1;
            padding: 16px;
            border-radius: 16px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .control-btn:active::before {
            width: 300px;
            height: 300px;
        }

        .control-btn.primary {
            background: linear-gradient(135deg, var(--main-color) 0%, #238B7F 100%);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(42, 157, 143, 0.3);
        }

        .control-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(42, 157, 143, 0.4);
        }

        .control-btn.secondary {
            background: var(--white);
            color: var(--main-color);
            border: 2px solid var(--main-color);
        }

        .control-btn.secondary:hover {
            background: rgba(42, 157, 143, 0.05);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--white);
            border-top: 1px solid rgba(38, 70, 83, 0.1);
            padding: 12px 0;
            z-index: 100;
        }

        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-item:hover {
            color: var(--main-color);
        }

        .nav-item.active {
            color: var(--main-color);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 3px;
            background: var(--main-color);
            border-radius: 0 0 3px 3px;
        }

        .nav-icon {
            font-size: 22px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        /* ì•Œë¦¼ ë©”ì‹œì§€ */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--white);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px var(--shadow-hover);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        .notification.error {
            border-left: 4px solid var(--error);
        }

        /* íƒ€ì„ìŠ¤íƒ¬í”„ */
        .last-update {
            text-align: center;
            padding: 12px 24px;
            font-size: 12px;
            color: rgba(38, 70, 83, 0.5);
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(42, 157, 143, 0.1);
            border-top-color: var(--main-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .loading-spinner.active {
            display: block;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 480px) {
            .container {
                border-radius: 0;
            }
            
            .header {
                border-radius: 0 0 20px 20px;
            }
        }

        /* ë‹¤í¬ ëª¨ë“œ ì§€ì› */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #1a1a1a;
                --white: #2a2a2a;
                --text-color: #f0f0f0;
                --shadow: rgba(0, 0, 0, 0.3);
                --shadow-hover: rgba(0, 0, 0, 0.5);
            }
            
            .stat-card {
                border-color: rgba(42, 157, 143, 0.3);
            }
            
            .medication-card {
                background: #2a2a2a;
            }
            
            .sensor-status {
                background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            }
            
            .bottom-nav {
                background: #2a2a2a;
                border-top-color: rgba(255, 255, 255, 0.1);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="greeting">
                <h1>ì•ˆë…•í•˜ì„¸ìš”!</h1>
                <div class="name">COSS ì‚¬ìš©ìë‹˜</div>
                <div class="subtitle">ì˜¤ëŠ˜ë„ ê±´ê°•í•œ í•˜ë£¨ ë³´ë‚´ì„¸ìš” ğŸ’Š</div>
            </div>
        </div>

        <!-- ìƒíƒœ íˆì–´ë¡œ ì¹´ë“œ -->
        <div class="status-hero">
            <div class="status-content">
                <div class="status-icon pending" id="mainStatusIcon">
                    â°
                </div>
                <div class="status-text">
                    <h2 id="mainStatusTitle">ì„¼ì„œ ì—°ê²° ëŒ€ê¸° ì¤‘</h2>
                    <p id="mainStatusMessage">ì•½í†µ ì„¼ì„œì™€ ì—°ê²°ì„ ì‹œë„í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
                </div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ì„¼ì„œ ìƒíƒœ -->
        <div class="sensor-status">
            <div class="sensor-header">
                <div class="sensor-title">ğŸ“¡ ì‹¤ì‹œê°„ ì„¼ì„œ ìƒíƒœ</div>
                <div class="sensor-indicator inactive" id="connectionIndicator">
                    ì—°ê²° ëŠê¹€
                </div>
            </div>
            <div class="sensor-value-display">
                <span class="value" id="sensorValue">-</span>
                <span class="unit">ìƒíƒœê°’</span>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ê°ì§€ íšŸìˆ˜</div>
                    <div class="stat-value highlight" id="detectionCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì—°ê²° ì‹œê°„</div>
                    <div class="stat-value" id="connectionTime">00:00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">í˜„ì¬ ìƒíƒœ</div>
                    <div class="stat-value" id="currentState">ëŒ€ê¸°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì—…ë°ì´íŠ¸</div>
                    <div class="stat-value" id="updateRate">1ì´ˆ</div>
                </div>
            </div>
        </div>

        <!-- ì•½ ë³µìš© í˜„í™© -->
        <div class="medication-section">
            <div class="section-title">
                ğŸ’Š ì˜¤ëŠ˜ì˜ ë³µì•½ ì¼ì •
            </div>
            <div class="medication-card">
                <div class="medication-icon">ğŸ’Š</div>
                <div class="medication-info">
                    <div class="medication-name">ì•„ì¹¨ ì•½</div>
                    <div class="medication-time">08:00 ë³µìš© ì˜ˆì •</div>
                </div>
                <div class="medication-status pending" id="morningStatus">ëŒ€ê¸°ì¤‘</div>
            </div>
            <div class="medication-card">
                <div class="medication-icon">ğŸ’Š</div>
                <div class="medication-info">
                    <div class="medication-name">ì ì‹¬ ì•½</div>
                    <div class="medication-time">13:00 ë³µìš© ì˜ˆì •</div>
                </div>
                <div class="medication-status pending" id="afternoonStatus">ëŒ€ê¸°ì¤‘</div>
            </div>
            <div class="medication-card">
                <div class="medication-icon">ğŸ’Š</div>
                <div class="medication-info">
                    <div class="medication-name">ì €ë… ì•½</div>
                    <div class="medication-time">19:00 ë³µìš© ì˜ˆì •</div>
                </div>
                <div class="medication-status pending" id="eveningStatus">ëŒ€ê¸°ì¤‘</div>
            </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
        <div class="control-section">
            <div class="control-buttons">
                <button class="control-btn primary" id="connectBtn" onclick="toggleConnection()">
                    ğŸ”— ì„œë²„ ì—°ê²°
                </button>
                <button class="control-btn secondary" onclick="resetCounter()">
                    ğŸ”„ ì¹´ìš´í„° ì´ˆê¸°í™”
                </button>
            </div>
        </div>

        <!-- ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ -->
        <div class="last-update" id="lastUpdate">
            ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -
        </div>

        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
        <div class="loading-spinner" id="loadingSpinner"></div>

        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="bottom-nav">
            <div class="nav-items">
                <div class="nav-item active">
                    <div class="nav-icon">ğŸ </div>
                    <div class="nav-label">í™ˆ</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">ğŸ“Š</div>
                    <div class="nav-label">í†µê³„</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">ğŸ“…</div>
                    <div class="nav-label">ìº˜ë¦°ë”</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">âš™ï¸</div>
                    <div class="nav-label">ì„¤ì •</div>
                </div>
            </div>
        </div>

        <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
        <div class="notification" id="notification">
            <span id="notificationIcon">âœ…</span>
            <span id="notificationMessage">ì•Œë¦¼ ë©”ì‹œì§€</span>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let isConnected = false;
        let intervalId = null;
        // ì„œë²„ URLì„ ê³ ì •ê°’ìœ¼ë¡œ ì„¤ì • (ì„œë²„ ì„¤ì • ë²„íŠ¼ ì œê±°)
        const serverUrl = 'https://port-0-coss-mi0kk25df8c7e306.sel3.cloudtype.app';
        let detectionCount = 0;
        let connectionStartTime = null;
        let connectionTimer = null;
        let lastSensorValue = -1;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì—°ê²°
        window.addEventListener('load', () => {
            setTimeout(() => {
                connect();
            }, 1000);
        });

        function toggleConnection() {
            if (isConnected) {
                disconnect();
            } else {
                connect();
            }
        }

        function connect() {
            showNotification('ì„œë²„ ì—°ê²°ì„ ì‹œë„í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
            
            isConnected = true;
            connectionStartTime = Date.now();
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('connectBtn').innerHTML = 'ğŸ”Œ ì—°ê²° ëŠê¸°';
            document.getElementById('connectionIndicator').className = 'sensor-indicator active';
            document.getElementById('connectionIndicator').textContent = 'ì—°ê²°ë¨';
            
            // ë©”ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateMainStatus('connected');
            
            // ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ
            document.getElementById('loadingSpinner').classList.add('active');
            
            // ì—°ê²° ì‹œê°„ íƒ€ì´ë¨¸ ì‹œì‘
            connectionTimer = setInterval(updateConnectionTime, 1000);
            
            // ë°ì´í„° í´ë§ ì‹œì‘
            fetchSensorData();
            intervalId = setInterval(fetchSensorData, 1000);
            
            setTimeout(() => {
                document.getElementById('loadingSpinner').classList.remove('active');
                showNotification('ì„œë²„ì™€ ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }, 1500);
        }

        function disconnect() {
            isConnected = false;
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('connectBtn').innerHTML = 'ğŸ”— ì„œë²„ ì—°ê²°';
            document.getElementById('connectionIndicator').className = 'sensor-indicator inactive';
            document.getElementById('connectionIndicator').textContent = 'ì—°ê²° ëŠê¹€';
            
            // ë©”ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateMainStatus('disconnected');
            
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
            
            if (connectionTimer) {
                clearInterval(connectionTimer);
                connectionTimer = null;
            }
            
            showNotification('ì„œë²„ ì—°ê²°ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'warning');
        }

        async function fetchSensorData() {
            try {
                const response = await fetch(`${serverUrl}/value`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }

                const data = await response.json();
                updateDisplay(data);

            } catch (error) {
                console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                if (isConnected) {
                    showNotification('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                }
            }
        }

        function updateDisplay(data) {
            const sensorValue = data.a !== undefined ? data.a : '-';
            
            // ì„¼ì„œê°’ ì—…ë°ì´íŠ¸
            document.getElementById('sensorValue').textContent = sensorValue;
            
            // ê°’ì´ ë³€ê²½ë˜ì—ˆê³  1ë¡œ ë³€ê²½ëœ ê²½ìš° (ì•½í†µ ì œê±° ê°ì§€)
            if (lastSensorValue !== sensorValue && sensorValue === 1) {
                detectionCount++;
                document.getElementById('detectionCount').textContent = detectionCount;
                
                // ì•½í†µ ì œê±° ì•Œë¦¼
                showNotification('ì•½í†µì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤! ì•½ì„ ë³µìš©í•˜ì„¸ìš”.', 'warning');
                
                // ë©”ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateMainStatus('detected');
                
                // ë³µì•½ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì‹œê°„ëŒ€ì— ë”°ë¼)
                updateMedicationStatus();
            } else if (lastSensorValue === 1 && sensorValue === 0) {
                // ì•½í†µì´ ë‹¤ì‹œ ì œìë¦¬ë¡œ ëŒì•„ì˜´
                showNotification('ì•½í†µì´ ì œìë¦¬ì— ë†“ì˜€ìŠµë‹ˆë‹¤.', 'success');
                updateMainStatus('returned');
            }
            
            lastSensorValue = sensorValue;
            
            // í˜„ì¬ ìƒíƒœ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const currentState = document.getElementById('currentState');
            if (sensorValue === 1) {
                currentState.textContent = 'ê°ì§€';
                currentState.style.color = 'var(--point-color)';
            } else if (sensorValue === 0) {
                currentState.textContent = 'ì •ìƒ';
                currentState.style.color = 'var(--success)';
            } else {
                currentState.textContent = 'ëŒ€ê¸°';
                currentState.style.color = 'var(--text-color)';
            }
            
            // íƒ€ì„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR');
            document.getElementById('lastUpdate').textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${timeString}`;
        }

        function updateMainStatus(status) {
            const icon = document.getElementById('mainStatusIcon');
            const title = document.getElementById('mainStatusTitle');
            const message = document.getElementById('mainStatusMessage');
            
            switch(status) {
                case 'connected':
                    icon.className = 'status-icon completed';
                    icon.textContent = 'âœ…';
                    title.textContent = 'ì„¼ì„œ ì—°ê²° ì™„ë£Œ';
                    message.textContent = 'ì•½í†µ ëª¨ë‹ˆí„°ë§ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤';
                    break;
                case 'detected':
                    icon.className = 'status-icon detected';
                    icon.textContent = 'ğŸ’Š';
                    title.textContent = 'ì•½í†µì´ ì œê±°ë¨';
                    message.textContent = 'ì•½ì„ ë³µìš© ì¤‘ì´ì‹ ê°€ìš”?';
                    break;
                case 'returned':
                    icon.className = 'status-icon completed';
                    icon.textContent = 'âœ…';
                    title.textContent = 'ë³µì•½ ì™„ë£Œ';
                    message.textContent = 'ì•½í†µì´ ì œìë¦¬ì— ìˆìŠµë‹ˆë‹¤';
                    break;
                case 'disconnected':
                    icon.className = 'status-icon pending';
                    icon.textContent = 'â°';
                    title.textContent = 'ì„¼ì„œ ì—°ê²° ëŒ€ê¸° ì¤‘';
                    message.textContent = 'ì„œë²„ì™€ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤';
                    break;
            }
        }

        function updateMedicationStatus() {
            const now = new Date();
            const hours = now.getHours();
            
            if (hours >= 6 && hours < 11) {
                // ì•„ì¹¨ ì•½ ë³µìš©
                const morningStatus = document.getElementById('morningStatus');
                morningStatus.className = 'medication-status taken';
                morningStatus.textContent = 'ë³µìš©ì™„ë£Œ';
            } else if (hours >= 11 && hours < 16) {
                // ì ì‹¬ ì•½ ë³µìš©
                const afternoonStatus = document.getElementById('afternoonStatus');
                afternoonStatus.className = 'medication-status taken';
                afternoonStatus.textContent = 'ë³µìš©ì™„ë£Œ';
            } else if (hours >= 16 && hours < 22) {
                // ì €ë… ì•½ ë³µìš©
                const eveningStatus = document.getElementById('eveningStatus');
                eveningStatus.className = 'medication-status taken';
                eveningStatus.textContent = 'ë³µìš©ì™„ë£Œ';
            }
        }

        function updateConnectionTime() {
            if (!connectionStartTime) return;
            
            const elapsed = Date.now() - connectionStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('connectionTime').textContent = timeString;
        }

        function resetCounter() {
            detectionCount = 0;
            document.getElementById('detectionCount').textContent = '0';
            
            // ë³µì•½ ìƒíƒœ ì´ˆê¸°í™”
            document.querySelectorAll('.medication-status').forEach(status => {
                status.className = 'medication-status pending';
                status.textContent = 'ëŒ€ê¸°ì¤‘';
            });
            
            showNotification('ì¹´ìš´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const messageElement = document.getElementById('notificationMessage');
            
            // ì•„ì´ì½˜ ì„¤ì •
            switch(type) {
                case 'success':
                    icon.textContent = 'âœ…';
                    notification.className = 'notification success show';
                    break;
                case 'warning':
                    icon.textContent = 'âš ï¸';
                    notification.className = 'notification warning show';
                    break;
                case 'error':
                    icon.textContent = 'âŒ';
                    notification.className = 'notification error show';
                    break;
                default:
                    icon.textContent = 'â„¹ï¸';
                    notification.className = 'notification show';
            }
            
            messageElement.textContent = message;
            
            // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´í…œ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                this.classList.add('active');
                
                const label = this.querySelector('.nav-label').textContent;
                showNotification(`${label} ë©”ë‰´ëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤`, 'info');
            });
        });

        // ì•½ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.medication-card').forEach(card => {
            card.addEventListener('click', function() {
                const medName = this.querySelector('.medication-name').textContent;
                showNotification(`${medName} ìƒì„¸ ì •ë³´ëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤`, 'info');
            });
        });
    </script>
</body>
</html>
