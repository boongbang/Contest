<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSS - 일정 관리</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #4F46E5; --bg: #F3F4F6; }
        body { background: var(--bg); margin: 0; padding-bottom: 80px; font-family: 'Pretendard', sans-serif; }
        .header { background: white; padding: 20px; font-weight: 700; font-size: 18px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .container { padding: 20px; }
        
        .add-card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; display: flex; gap: 10px; }
        .time-input { flex: 1; padding: 10px; border: 1px solid #E5E7EB; border-radius: 10px; font-size: 16px; }
        .add-btn { background: var(--primary); color: white; border: none; padding: 0 20px; border-radius: 10px; cursor: pointer; }

        .schedule-list { list-style: none; padding: 0; }
        .schedule-item { background: white; padding: 15px 20px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .time-text { font-size: 18px; font-weight: 600; color: #1F2937; }
        .del-btn { color: #EF4444; background: none; border: none; cursor: pointer; font-size: 16px; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px 0; display: flex; justify-content: space-around; border-top: 1px solid #E5E7EB; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #9CA3AF; text-decoration: none; font-size: 12px; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="header">복약 알림 설정</div>

    <div class="container">
        <div class="add-card">
            <input type="time" id="timeInput" class="time-input">
            <button onclick="addSchedule()" class="add-btn">추가</button>
        </div>

        <ul class="schedule-list" id="list">
            </ul>
    </div>

    <nav class="nav-bar">
        <a href="dashboard.html" class="nav-item"> <i class="fa-solid fa-house"></i>홈 </a>
        <a href="schedule.html" class="nav-item active"> <i class="fa-regular fa-clock"></i>일정 </a>
        <a href="report.html" class="nav-item"> <i class="fa-solid fa-chart-pie"></i>리포트 </a>
        <a href="settings.html" class="nav-item"> <i class="fa-solid fa-gear"></i>설정 </a>
    </nav>

    <script>
        const SERVER = 'https://port-0-coss-mi0kk25df8c7e306.sel3.cloudtype.app';
        const token = localStorage.getItem('coss_token');

        async function loadSchedules() {
            const res = await fetch(SERVER + '/api/schedule', { headers: { 'Authorization': `Bearer ${token}` } });
            const json = await res.json();
            const list = document.getElementById('list');
            list.innerHTML = '';
            
            json.data.forEach(item => {
                const li = document.createElement('li');
                li.className = 'schedule-item';
                li.innerHTML = `
                    <span class="time-text">${item.scheduled_time}</span>
                    <button class="del-btn" onclick="deleteSchedule(${item.id})"><i class="fa-solid fa-trash"></i></button>
                `;
                list.appendChild(li);
            });
        }

        async function addSchedule() {
            const time = document.getElementById('timeInput').value;
            if(!time) return alert('시간을 선택하세요');
            await fetch(SERVER + '/api/schedule', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify({ time, label: '정기 복약' })
            });
            loadSchedules();
        }

        async function deleteSchedule(id) {
            if(!confirm('삭제하시겠습니까?')) return;
            await fetch(`${SERVER}/api/schedule/${id}`, {
                method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` }
            });
            loadSchedules();
        }

        loadSchedules();
    </script>
</body>
</html>
